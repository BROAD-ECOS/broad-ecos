nginx:
  build: docker/nginx
  links:
    - moodle
  ports:
    - "80:80"
    - "443:443"
  volumes_from:
    - moodle
  volumes:
    - config/nginx:/etc/nginx/conf.d/
    - log/nginx:/var/log/nginx

moodle:
  build: docker/moodle
  links:
    - mariadb
    - memcached
    - broadauth
  ports:
    - "9000:9000"
  volumes:
    - src/broad-ecos-moodle-mod:/var/www/html/moodle/mod/broadecosmod
    - config/moodle/config.php:/var/www/html/moodle/config.php

broadauth:
    build: docker/broad/auth
    hostname: dev.broadecos.auth
    ports:
      - "9999:9999"
    volumes:
      - src/AuthService/build/libs/demo-0.0.1.jar:/opt/app.jar
      - config/broad/auth/application.properties:/opt/application.properties
      - log/broad/auth/:/var/log

mariadb:
  build: docker/mariadb
  ports:
    - "3307:3306"
  volumes:
    - log/mariadb:/var/log/mysql
    - data/mariadb:/var/lib/mysql
  env_file:
    - ./envvars/mariadb.env

memcached:
  build: docker/memcached
  ports:
    - "11211:11211"
